<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="zhuangguangtuan&#39;s blog">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        Android DataBinding 笔记 - undefined
        
    </title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/aircloud.css">

    
<link rel="stylesheet" href="/css/gitment.css">

    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
<meta name="generator" content="Hexo 5.2.0"></head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> not today </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar ">
            <img src="/img/avatar.png" />
        </div>
        <div class="name">
            <i>zhuangguangtuan</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>HOME</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>TAGS</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>ARCHIVES</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>ABOUT</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x00-%E4%BF%AE%E6%94%B9gradle%E6%96%87%E4%BB%B6"><span class="toc-text">0x00 修改gradle文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-%E6%A0%BC%E5%BC%8F"><span class="toc-text">0x01 格式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A%E5%92%8C%E4%BA%8B%E4%BB%B6%E7%BB%91%E5%AE%9A"><span class="toc-text">0x02 数据绑定和事件绑定</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-BindAdapter%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">0x03 BindAdapter的使用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04-DataBinding%E5%9C%A8RecyclerView%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">0x04 DataBinding在RecyclerView的使用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x05-%E5%85%B6%E4%BB%96%E7%94%A8%E6%B3%95"><span class="toc-text">0x05 其他用法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x06-%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91"><span class="toc-text">0x06 开发过程中遇到的坑</span></a></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">search</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> not today </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        Android DataBinding 笔记
    </div>

    <div class="post-meta">
        <span class="attr">Post：<span>2016-01-22 21:55:35</span></span>
        
        <span class="attr">Tags：/
        
        <a class="tag" href="/tags/#android" title="android">android</a>
        <span>/</span>
        
        <a class="tag" href="/tags/#mvvm" title="mvvm">mvvm</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">Visit：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <p>hello android databinding!</p>
<a id="more"></a>

<h1 id="0x00-修改gradle文件"><a href="#0x00-修改gradle文件" class="headerlink" title="0x00 修改gradle文件"></a>0x00 修改gradle文件</h1><ul>
<li>整个项目的<code>bulid.gradle</code></li>
</ul>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">buildscript</span> &#123;</span><br><span class="line">    <span class="keyword">repositories</span> &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">dependencies</span> &#123;</span><br><span class="line">        <span class="keyword">classpath</span> <span class="string">&#x27;com.android.tools.build:gradle:1.5.0&#x27;</span></span><br><span class="line">        <span class="keyword">classpath</span> <span class="string">&quot;com.android.databinding:dataBinder:1.+&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<!-- more -->

<ul>
<li>单个模块的<code>bulid.gradle</code></li>
</ul>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">&#x27;com.android.application&#x27;</span></span><br><span class="line">apply plugin: <span class="string">&#x27;com.android.databinding&#x27;</span></span><br></pre></td></tr></table></figure>

<h1 id="0x01-格式"><a href="#0x01-格式" class="headerlink" title="0x01 格式"></a>0x01 格式</h1><p>在原有的布局文件中，加上一层<code>layout</code>标签包裹住，需要放置的数据，则放在<code>data</code>标签里。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">&quot;field&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.example.type&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- here is the old layout--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">LinearLayout</span> /&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- here is the old layout--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>note:<br>截止至<code>2016-04-01</code>，在目前的Android Studio IDE<code>1.5.1</code>以及dataBinder<code>1.0-rc5</code>版本中，还没有办法做到xml文件里，<code>data</code>标签里，包名，类名的<strong>自动补全</strong>。</p>
</blockquote>
<h1 id="0x02-数据绑定和事件绑定"><a href="#0x02-数据绑定和事件绑定" class="headerlink" title="0x02 数据绑定和事件绑定"></a>0x02 数据绑定和事件绑定</h1><ul>
<li><code>layout.xml</code>如下，对于<code>type</code>属性，如果该类属于<code>java.lang</code>包的话，可以省去包名，如<code>String</code>，<code>Integer</code>等。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.example.User&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">&quot;listener&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.example.Listener&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;fill_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;fill_parent&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;fill_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;fill_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;@&#123;user.name&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;fill_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;fill_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:onClick</span>=<span class="string">&quot;@&#123;listener.onClick&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>com.example.User.java</code>如下</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>com.example.Listener.java</code>如下</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Listener</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 注意这里的onClick方法需要将View作为参数传入</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>每一个使用dataBinding的layout文件，都会被编译产生一个对应的类，这个类的位置在<code>build/intermediates/classes/debug/packageName/databinding/xxxBinding.java</code>中，并且遵循驼峰命名法</p>
<blockquote>
<p>如 main_activity.xml –&gt; MainActivityBinding.java</p>
</blockquote>
</li>
<li><p>其中带有ID的控件，都会对应生成一个变量，同样遵循驼峰命名法</p>
<blockquote>
<p>如 btn_register –&gt; btnRegister</p>
</blockquote>
</li>
<li><p>基于<code>&lt;variable name=&quot;user&quot; type=&quot;com.example.User&quot;/&gt;</code>这样子的声明，生成的<code>xxxBinding.java</code>会有一个<code>setUser(User user)</code>方法。</p>
</li>
<li><p>在Activity里这样子调用和绑定</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">   MainActivityBinding binding =</span><br><span class="line">             DataBindingUtil.setContentView(<span class="keyword">this</span>, R.layout.main_activity);</span><br><span class="line">   User user = <span class="keyword">new</span> User(<span class="string">&quot;Test&quot;</span>, <span class="string">&quot;User&quot;</span>);</span><br><span class="line">   binding.setUser(user);</span><br><span class="line">   binding.btnRegister.setText(<span class="string">&quot;xxx&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在fragment中，可以在<code>onCreateView()</code>方法中进行数据绑定</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    FragmentLoginBinding dataBinding =</span><br><span class="line">            DataBindingUtil.inflate(inflater, R.layout.fragment_login, container, <span class="keyword">false</span>);</span><br><span class="line">    <span class="comment">// something initial</span></span><br><span class="line">    <span class="keyword">return</span> dataBinding.getRoot();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="0x03-BindAdapter的使用"><a href="#0x03-BindAdapter的使用" class="headerlink" title="0x03 BindAdapter的使用"></a>0x03 BindAdapter的使用</h1><p>对于非控件自带的attr，使用BindAdapter注解来实现，以一个<code>根据URL加载头像</code>的场景为例。</p>
<p>写一个ViewModel</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageViewModel</span> </span>&#123;</span><br><span class="line">    <span class="meta">@BindAdapter(&quot;bind:url&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">loadAvatar</span><span class="params">(ImageView img, String avatarUrl)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// load image by avatarUrl</span></span><br><span class="line">        loadAvatarByUrl(img, url);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在布局文件中加入注解中绑定的url属性（需要加入appNS）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:url</span>=<span class="string">&quot;@&#123;user.avatarUrl&#125;&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br></pre></td></tr></table></figure>

<p>再也不用在每一个需要用到头像的地方，都写类似下面的代码了。</p>
<p>虽然<code>loadAvatarByUrl(img, url)</code>的逻辑可能并不复杂，但是使用DataBinding胜在<code>将加载头像的逻辑完全从Activity或者Fragment中剥离出来</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ImageView img &#x3D; (ImageView)findViewById(R.id.img);</span><br><span class="line">loadAvatarByUrl(img, url);</span><br></pre></td></tr></table></figure>


<h1 id="0x04-DataBinding在RecyclerView的使用"><a href="#0x04-DataBinding在RecyclerView的使用" class="headerlink" title="0x04 DataBinding在RecyclerView的使用"></a>0x04 DataBinding在RecyclerView的使用</h1><p>dataBinding对<code>RecyclerView</code>的支持也非常好，用法很简便。</p>
<p>首先在原来的item布局文件中，加入<code>&lt;layout&gt;</code>和<code>&lt;data&gt;</code>等标签。</p>
<p>接着，在ViewHolder中声明：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> MyItemBinding binding;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ExprHolder</span><span class="params">(View itemView)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(itemView);</span><br><span class="line">            <span class="comment">// 这样即可完成绑定</span></span><br><span class="line">            binding = DataBindingUtil.bind(itemView);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> MyItemBinding <span class="title">getBinding</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> binding;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>在<code>onCreateViewHolder</code>回调方法中，将<code>LayoutInflater</code>加载进来的<code>View</code>作为构造函数传递给<code>ViewHolder</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> MyViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</span><br><span class="line">    View view = LayoutInflater.from(parent.getContext())</span><br><span class="line">                   .inflate(R.layout.item, parent, <span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MyViewHolder(view);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>onBindViewHolder</code>回调方法中，完成数据绑定</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(MyViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    Object obj = Objects.get(position);</span><br><span class="line">    holder.getBinding().setObj(obj); <span class="comment">// 完成数据绑定</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="0x05-其他用法"><a href="#0x05-其他用法" class="headerlink" title="0x05 其他用法"></a>0x05 其他用法</h1><ul>
<li><p>空值判断，使用<code>??</code>运算符进行空值判断，以下表达式的含义为，</p>
<ul>
<li>在TextView上，显示user的<code>name</code>字段，</li>
<li>user的<code>name</code>字段为空的话，显示user的<code>phone</code>字段，</li>
<li>如果user的<code>phone</code>字段为空的话，显示User的静态常量<code>NO_LOGIN</code>，作一个未登录的说明。</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:text</span>=<span class="string">&quot;@&#123;user.name ?? user.phone ?? User.NO_LOGIN&#125;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>原生代码对比：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">TextView tv = (TextView)findViewById(R.id.tv);</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;&quot;</span>.equals(user.getName())) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;&quot;</span>.equals(user.getPhone())) &#123;</span><br><span class="line">        tv.setText(User.NO_LOGIN);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    tv.setText(user.getPhone());</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">tv.setText(user.getName());</span><br></pre></td></tr></table></figure>

<ul>
<li>使用<code>import</code>标签引用一个包含有静态方法的辅助类</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span> = <span class="string">&quot;mInteger&quot;</span> <span class="attr">type</span> = <span class="string">&quot;int&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">type</span> = <span class="string">&quot;com.xxx.XxxHelper&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 在布局中可以这样子调用，就可以在java代码里省下findViewById，在if else中setVisibility()...了 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;fill_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;fill_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:visibility</span>=<span class="string">&quot;@&#123;XxxHelper.hasPermisson(mInteger) ? View.VISIBLE:View.GONE&#125;&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>使用资源文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">&quot;mode&quot;</span> <span class="attr">type</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">type</span>=<span class="string">&quot;com.config.Constants&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 在布局文件中引用资源文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/btn_register&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:text</span>=<span class="string">&quot;@&#123;mode == Constants.MODE_REGISTER? @string/btn_register : @string/reset_password&#125;&quot;</span> /&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>com.config.Constants</code>这样子写</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Constants</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MODE_REGISTER = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MODE_RESET_PASSWORD = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>别名 如果<code>import</code>标签引用到的两个类名相同，可以使用<code>alias</code>属性</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">type</span>=<span class="string">&quot;com.package.one.Klass&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">type</span>=<span class="string">&quot;com.package.two.Klass&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;KlassTwo&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="0x06-开发过程中遇到的坑"><a href="#0x06-开发过程中遇到的坑" class="headerlink" title="0x06 开发过程中遇到的坑"></a>0x06 开发过程中遇到的坑</h1><ol>
<li><p>在写xml文件的时候，由于插件的支持有限，有关dataBinding这一部分没有自动补全和提示，有时候编译的时候报错说<code>xxxDataBinding类不存在</code>之类的信息，一定是手抖写错了表达式，只要将Android Studio的<code>message</code>窗口（就是那个查看编译反馈的窗口）拉到最下面，一般都可以看到是哪一个布局文件中表达式写错了，修改对应的表达式即可。</p>
</li>
<li><p>由于dataBinding插件是实时编译的，有时候会出现以下情况，修改了某个布局文件的名字，或者其中控件的ID，也会报错，这时候只要找到对应生成的java文件删除，让插件自动重新编译即可。对应的java文件位置在：<code>build/intermediates/classes/debug/packageName/databinding/xxxBinding.java</code>，或者删除整个<code>build</code>文件夹也可。</p>
</li>
</ol>

        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>  Theme <a target="_blank" rel="noopener" href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = ""
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

<script src="/js/index.js"></script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




</html>
